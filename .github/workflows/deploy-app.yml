name: Build and connect to AKS (test)

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ リポジトリの中身を取得
      - name: Checkout repo
        uses: actions/checkout@v4

      # 2️⃣ Azureへログイン
      - name: Azure login
        uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      # 3️⃣ AKSの認証情報を取得（あなたの環境用）
      - name: Get AKS credentials
        run: |
          az aks get-credentials \
            --resource-group wiz-exercise-rg \
            --name wiz-aks-cluster \
            --overwrite-existing

      # 4️⃣ AKSへ接続して確認（安全な読み取りのみ）
      - name: Check AKS connection
        run: |
          kubectl get nodes
          kubectl get pods -A

